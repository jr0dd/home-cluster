---
- name: ubuntu | installing NFS (if enabled)
  apt:
    name: nfs-kernel-server
    state: present
  when: >
        zfs_enable_nfs is defined and
        zfs_enable_nfs

- name: ubuntu | un-installing NFS (if not enabled)
  apt:
    name: nfs-kernel-server
    state: absent
  when: >
        zfs_enable_nfs is defined and
        not zfs_enable_nfs

- name: ubuntu | configuring NFS Kernel Server
  template:
    src: etc/exports.j2
    dest: /etc/exports
    owner: root
    group: root
    mode: 0644
  notify:
    - restart nfs-kernel-server
    - start zfs-share
  when: >
        zfs_enable_nfs is defined and
        zfs_enable_nfs
