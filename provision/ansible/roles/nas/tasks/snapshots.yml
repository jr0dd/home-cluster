---
- name: ubuntu | Checking for ZFS-Auto-Snapshot package from the distribution
  command: apt-cache show zfs-auto-snapshot
  ignore_errors: true
  register: auto_snapshot
  when: zfs_enable_auto_snapshots
  changed_when: false
  failed_when: false
  check_mode: false

- name: ubuntu | Adding ZFS-Auto-Snapshot Repo
  apt_repository:
    repo: ppa:bob-ziuchkovski/zfs-auto-snapshot
    state: present
  when: >
    zfs_enable_auto_snapshots and
    auto_snapshot.stderr == 'E: No packages found'

- name: ubuntu | Installing ZFS-Auto-Snapshot
  apt:
    name: zfs-auto-snapshot
    state: present
  when: zfs_enable_auto_snapshots
