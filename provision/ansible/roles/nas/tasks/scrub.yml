---
- name: Copy ZFS scrub service
  ansible.builtin.template:
    src: lib/systemd/system/zfs-scrub@.service.j2
    dest: /lib/systemd/system/zfs-scrub@.service
    mode: 0644

- name: Copy ZFS scrub timer
  ansible.builtin.template:
    src: lib/systemd/system/zfs-scrub@.timer.j2
    dest: /lib/systemd/system/zfs-scrub@.timer
    mode: 0644

- name: Start ZFS scrub timer
  ansible.builtin.systemd:
    name: "zfs-scrub@{{ item.name }}.timer"
    daemon_reload: true
    enabled: true
    state: started
  with_items: "{{ zfs_pools }}"
