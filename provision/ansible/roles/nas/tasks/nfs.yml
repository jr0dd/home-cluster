---
- name: Install NFS
  ansible.builtin.apt:
    update_cache: yes
    pkg:
      - nfs-common
      - nfs-kernel-server
    state: present

- name: Configure NFS
  ansible.builtin.template:
    src: etc/exports.j2
    dest: /etc/exports
    mode: 0644
  when:
    - nfs_exports
    - nfs_exports | length > 0

- name: Reload NFS exports
  ansible.builtin.command:
    cmd: 'exportfs -ar'

- name: Restart NFS service
  ansible.builtin.systemd:
    name: nfs-kernel-server
    daemon_reload: true
    enabled: true
    state: restarted
