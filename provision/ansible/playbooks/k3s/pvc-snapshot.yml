- hosts:
    - k8s-0
  become: true
  gather_facts: true
  any_errors_fatal: true
  pre_tasks:
    - name: Pausing for 5 seconds...
      pause:
        seconds: 5
  tasks:
    - name: Create ZFS SNapshots of PVC's
      community.kubernetes.k8s:
        state: present
        definition:
          apiVersion: snapshot.storage.k8s.io/v1
          kind: VolumeSnapshot
          metadata:
            name: "{{ item.name }}-{{ ansible_date_time.date }}"
            namespace: "{{ item.namespace }}"
          spec:
            volumeSnapshotClassName: zfspv-snapclass
            source:
              persistentVolumeClaimName: "{{ item.pvc }}"
      with_items: "{{ pvc_zfs_snapshots }}"
