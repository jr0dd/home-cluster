---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: homer
  namespace: home
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: homer
      version: 6.0.0
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home-charts
        namespace: flux-system
      interval: 5m
  values:
    image:
      repository: b4bz/homer
      tag: 21.07.1
    controller:
      enabled: true
      replicas: 1
      strategy: RollingUpdate
    env:
      TZ: "America/New_York"
      UID: 568
      GID: 568
    service:
      main:
        ports:
          http:
            port: 8080
    persistence:
      config:
        enabled: true
        type: pvc
        existingClaim: homer
        mountPath: /www/assets
    ingress:
      main:
        enabled: true
        ingressClassName: traefik
        annotations:
          cert-manager.io/cluster-issuer: letsencrypt-production
          traefik.ingress.kubernetes.io/router.entrypoints: websecure
        hosts:
        - host: "homer.${SECRET_DOMAIN}"
          paths:
          - path: /
            pathType: Prefix
        tls:
        - secretName: homer-tls
          hosts:
          - "homer.${SECRET_DOMAIN}"
    podAnnotations:
      configmap.reloader.stakater.com/reload: "homer"
    configmap:
      enabled: true
      config: |
        # Homepage configuration
        # See https://fontawesome.com/icons for icons options

        title: "K8s Home Dashboard"
        subtitle: "K8s"
        logo: "assets/tools/k8s.png"

        header: true
        footer: false

        # Optional theme customization
        theme: default
        colors:
          light:
            highlight-primary: "#3367d6"
            highlight-secondary: "#4285f4"
            highlight-hover: "#5a95f5"
            background: "#f5f5f5"
            card-background: "#ffffff"
            text: "#363636"
            text-header: "#ffffff"
            text-title: "#303030"
            text-subtitle: "#424242"
            card-shadow: rgba(0, 0, 0, 0.1)
            link-hover: "#363636"
          dark:
            highlight-primary: "#3367d6"
            highlight-secondary: "#4285f4"
            highlight-hover: "#5a95f5"
            background: "#131313"
            card-background: "#2b2b2b"
            text: "#eaeaea"
            text-header: "#ffffff"
            text-title: "#fafafa"
            text-subtitle: "#f5f5f5"
            card-shadow: rgba(0, 0, 0, 0.4)
            link-hover: "#ffdd57"

        links:
          - name: "GitOps"
            icon: "fab fa-github"
            url: "https://github.com/jr0dd/k8s-gitops"
            target: "_blank"
          - name: "KaH"
            icon: "fab fa-github"
            url: "https://github.com/k8s-at-home"
            target: "_blank"

        services:
          - name: "Devices"
            icon: "fas fa-server"
            items:
              - name: "TrueNAS SCALE"
                logo: "assets/tools/truenas.png"
                subtitle: "TrueNAS"
                tag: "device"
                url: "https://truenas.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "HDHomeRun"
                logo: "assets/tools/hdhomerun.png"
                subtitle: "HDHomeRun"
                tag: "device"
                url: "https://hdhomerun.${SECRET_DOMAIN}"
              - name: "ASRock Rack IPMI"
                logo: "assets/tools/asrockrack.png"
                subtitle: "IPMI"
                tag: "device"
                url: "http://ipmi.${SECRET_DOMAIN}"
                target: "_blank"
        
          - name: "Media"
            icon: "fas fa-photo-video"
            items:
              - name: "Plex"
                logo: "assets/tools/plex.png"
                subtitle: "Plex"
                tag: "app"
                url: "https://plex.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "MKVToolNix"
                logo: "assets/tools/mkvtoolnix.png"
                subtitle: "MKVToolNix"
                tag: "app"
                url: "https://mkvtoolnix.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "Tautulli"
                logo: "assets/tools/tautulli.png"
                subtitle: "Tautulli"
                tag: "app"
                url: "https://tautulli.${SECRET_DOMAIN}"
                target: "_blank"
          
          - name: "Downloads"
            icon: "fas fa-cloud-download-alt"
            items:
              - name: "qBittorrent"
                logo: "assets/tools/qbittorrent.png"
                subtitle: "qBittorrent"
                tag: "app"
                url: "https://qb.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "Lidarr"
                logo: "assets/tools/qbittorrent.png"
                subtitle: "Lidarr"
                tag: "app"
                url: "https://lidarr.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "Overseerr"
                logo: "assets/tools/overseerr.png"
                subtitle: "Overseerr"
                tag: "app"
                url: "https://requests.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "Prowlarr"
                logo: "assets/tools/prowlarr.png"
                subtitle: "Prowlarr"
                tag: "app"
                url: "https://prowlarr.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "Radarr"
                logo: "assets/tools/radarr.png"
                subtitle: "Radarr"
                tag: "app"
                url: "https://radarr.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "Sonarr"
                logo: "assets/tools/sonarr.png"
                subtitle: "Sonarr"
                tag: "app"
                url: "https://sonarr.${SECRET_DOMAIN}"
                target: "_blank"
          
          - name: "Monitoring"
            icon: "fas fa-project-diagran"
            items:
              - name: "Alertmanager"
                logo: "assets/tools/prometheus.png"
                subtitle: "Alertmanager"
                tag: "app"
                url: "https://alertmanager.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "Grafana"
                logo: "assets/tools/grafana.png"
                subtitle: "Grafana"
                tag: "app"
                url: "https://grafana.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "Homebridge"
                logo: "assets/tools/homebridge.png"
                subtitle: "Homebridge"
                tag: "app"
                url: "https://homebridge.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "Prometheus"
                logo: "assets/tools/prometheus.png"
                subtitle: "Prometheus"
                tag: "app"
                url: "https://prometheus.${SECRET_DOMAIN}"
                target: "_blank"
              - name: "Traefik"
                logo: "assets/tools/traefik.png"
                subtitle: "Traefik"
                tag: "app"
                url: "https://traefik.${SECRET_DOMAIN}"
                target: "_blank"
              # - name: "Thanos"
              #   logo: "assets/tools/thanos.png"
              #   subtitle: "Thanos"
              #   tag: "app"
              #   url: "https://thanos.${SECRET_DOMAIN}"
              #   target: "_blank"
        
          - name: "Misc"
            icon: "fas fa-hashtag"
            items:
              - name: "Authentik"
                logo: "assets/tools/authentik.png"
                subtitle: "Authentik"
                tag: "app"
                url: "https://id.${SECRET_DOMAIN}"
                target: "_blank"
              # - name: "Minio"
              #   logo: "assets/tools/minio.png"
              #   subtitle: "Minio"
              #   tag: "app"
              #   url: "https://minio.${SECRET_DOMAIN}"
              #   target: "_blank"
